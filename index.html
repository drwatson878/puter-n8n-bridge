<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Puter â†” n8n Bridge (Frontend Runner)</title>
 <script type="module">
    import * as puter from "./lib/puter.mjs";
    async function getInputFromN8N(url) {
      const r = await fetch(url, { method: "GET" });
      const j = await r.json();
      return j.message;
    }

    async function sendOutputToN8N(url, reply) {
      await fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ reply })
      });
    }

    async function runOnce() {
      const inputUrl = document.getElementById("https://n8n-0s88.onrender.com/webhook-test/chatbot-input").value.trim();
      const outputUrl = document.getElementById("https://n8n-0s88.onrender.com/webhook-test/chatbot-output").value.trim();
      const model = document.getElementById("model").value.trim() || "gpt-4.1-mini";

      const message = await getInputFromN8N(inputUrl);
      let reply = "";
      for await (const chunk of puter.ai.chat.completions.create({
        model,
        messages: [{ role: "user", content: message }]
      })) {
        reply += chunk?.choices?.[0]?.delta?.content || "";
      }
      await sendOutputToN8N(outputUrl, reply);
      document.getElementById("log").textContent = "ÙˆØ±ÙˆØ¯ÛŒ: " + message + "\n\nÙ¾Ø§Ø³Ø®: " + reply;
    }

    window.addEventListener("DOMContentLoaded", () => {
      document.getElementById("run").addEventListener("click", runOnce);
    });
  </script>
</head>
<body style="background:#111;color:#eee;font-family:sans-serif;padding:20px;">
  <h1>ðŸ”— Puter â†” n8n Bridge</h1>
  <p>Ø¢Ø¯Ø±Ø³ ÙˆØ¨Ù‡ÙˆÚ©â€ŒÙ‡Ø§ÛŒ n8n Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:</p>
  <input id="inputUrl" type="text" placeholder="n8n Webhook Input URL" size="60"/><br><br>
  <input id="outputUrl" type="text" placeholder="n8n Webhook Output URL" size="60"/><br><br>
  <input id="model" type="text" placeholder="gpt-4.1-mini" size="30"/><br><br>
  <button id="run">ðŸš€ Ø§Ø¬Ø±Ø§</button>
  <pre id="log" style="white-space:pre-wrap;background:#222;padding:12px;border-radius:8px;margin-top:12px;"></pre>
</body>
</html>
